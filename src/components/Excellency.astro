---
// const services = [
//   {
//     title: "Cartografía, catastro",
//     description: "El uso de imágenes satelitales para la elaboración de mapas es muy común hoy en día. Los clientes optan por imágenes de mayor resolución, a la vez que solicitan reducciones de precios.",
//     image: "/images/cartografia.webp",
//     features: ["Mapas topográficos", "Análisis de uso del suelo", "Monitoreo de cambios en el terreno"],
//     category: "Cartografía, catastro"
//   },
//   {
//     title: "Agricultura de precisión",
//     description: "La agricultura estadística es una demostracion de aplicacion exitosa de la observación de la Tierra desde el espacio. El precio de los datos por km cuadrado es un factor determinante. Las imágenes espaciales ayudarán a implementar prácticas de gestión agrícola sostenibles, a la vez que garantizan la preservación de los recursos de suelo, tierra y agua.",
//     image: "/images/agricultura.webp?height=400&width=600",
//     features: ["Análisis NDVI", "Evaluación de la salud de los cultivos", "Planificación de riego"],
//     category: "Agricultura"
//   },
//   {
//     title: "Verificación de la cadena de suministro",
//     description: "La gestión forestal es fundamental para el monitoreo de la evolución del clima mundial. Además, es un indicador clave del impacto de las actividades humanas en nuestro entorno natural. V-Globe es un proveedor ideal para este tipo de aplicación que requiere una cobertura rápida y masiva.",
//     image: "/images/bosque-canada.webp?height=400&width=600",
//     features: ["Monitoreo de la deforestación", "Gestión sostenible de bosques", "Análisis de biodiversidad"],
//     category: "Forestación"
//   },
//   {
//     title: "Recursos pesqueros",
//     description: "La teledetección de las propiedades oceánicas tiene el potencial de proporcionar información para la gobernanza de los ecosistemas a escala global y regional. Gracias a su cobertura total de la Tierra y a su capacidad de observación espectral, v-GLOBE puede contribuir a la gestión pesquera mediante la observación del color del océano.",
//     image: "/images/aukland-new-zealand.webp?height=400&width=600",
//     features: ["Monitoreo de recursos pesqueros", "Análisis de hábitats marinos", "Gestión sostenible"],
//     category: "Marítimo"
//   },
//   {
//     title: "Optimización de rutas",
//     description: "Optimización del consumo de combustible y de las emisiones en el transporte. La teledetección espacial proporciona una visión completa de la infraestructura de transporte, lo que permite a las empresas y gobiernos optimizar las rutas de transporte, reducir los costos operativos y minimizar el impacto ambiental.",
//     image: "/images/gulf-mex.webp?height=400&width=600",
//     features: ["Optimización de rutas", "Reducción de costos operativos", "Minimización del impacto ambiental"],
//     category: "Transporte y Logística"
//   },
//   {
//     title: "Preservación de la vida silvestre y paisaje natural",
//     description: "La información recopilada desde el espacio facilita un monitoreo confiable y consistente, al combinarse con otros datos digitales para crear mapas, imágenes y gráficos dinámicos que pueden emplearse en la investigación o para orientar la gestión de la vida silvestre. Los satélites con ciclos de actualización rápidos, como v-GLOBE, son ideales para la generación repetitiva de imágenes y el monitoreo de los cambios naturales.",
//     image: "/images/rio-amazonas.webp?height=400&width=600",
//     features: ["Monitoreo de vida silvestre", "Conservación de hábitats", "Análisis de biodiversidad"],
//     category: "Flora y Fauna"
//   },
//   {
//     title: "Petróleo, gas, minerales, aguas subterráneas, energía hidráulica",
//     description: "En el sector del petróleo y gas en alta mar, el costo de construir plataformas de producción capaces de soportar condiciones climáticas severas se está volviendo indispensable.",
//     image: "/images/Mountain-elgon-kenya.webp?height=400&width=600",
//     features: ["Exploración de recursos", "Monitoreo ambiental", "Planificación de proyectos"],
//     category: "Recursos Naturales"
//   },  
//   {
//     title: "Ingeniería civil y gestión de la construcción urbana",
//     description: "Los datos de teledetección satelital se han utilizado con éxito para el mapeo, la supervisión, la planificación y el desarrollo de la expansión urbana, el uso del suelo y el entorno urbano. También se puede evaluar el tráfico, la oferta inmobiliaria y turística, así como, en muchos países en desarrollo, la expansión de barrios marginales sobre terrenos baldíos y la zonificación del uso del suelo urbano.",
//     image: "/images/unknowplace.webp?height=400&width=600",
//     features: ["Monitoreo de infraestructura", "Planificación urbana", "Análisis de crecimiento"],
//     category: "Ingeniería Civil"
//   },
//   {
//     title: "Alerta temprana",
//     description: "Predicción de inundaciones, incendios forestales y brotes de enfermedades. La teledetección espacial proporciona una visión integral de los patrones climáticos, la temperatura del suelo y otros factores ambientales que pueden ayudar a predecir eventos extremos. Esta información es crucial para la planificación y respuesta a desastres.",
//     image: "/images/niza-FRANCIA.webp?height=400&width=600",
//     features: ["Predicción de inundaciones", "Monitoreo de incendios forestales", "Detección de brotes de enfermedades"],
//     category: "Alerta temprana"
//   },
//   {
//     title: "Análisis post-evento",
//     description: "El análisis post-evento implica el uso de imágenes satelitales para evaluar el impacto de eventos naturales como terremotos, inundaciones y huracanes. Estas imágenes ayudan a las autoridades a comprender la magnitud del daño, planificar la recuperación y coordinar los esfuerzos de ayuda.",
//     image: "/images/gulf-mex.webp?height=400&width=600",
//     features: ["Evaluación de daños", "Planificación de recuperación", "Coordinación de ayuda"],
//     category: "Análisis Post-Evento"
//   },
//   {
//     title: "Experiencias para el consumidor",
//     description: "Alertas en tiempo real: calidad del aire, niveles de UV, condiciones meteorológicas y polen. Las imágenes satelitales proporcionan datos precisos sobre la calidad del aire, la radiación UV y otros factores ambientales que afectan la salud pública. Estas alertas ayudan a las personas a tomar decisiones informadas sobre su salud y bienestar.",
//     image: "/images/estrecho-gibraltar.webp?height=400&width=600",
//     features: ["Alertas de calidad del aire", "Niveles de radiación UV", "Condiciones meteorológicas locales"],
//     category: "Consumidores"
//   },
// ];
const { t } = Astro.props;
const excellency = t.excellency || {};
const services = excellency.services || [];
const cta = excellency.cta || {};
import PortfolioModal from './Modal-Carousel.astro';

---

<section class="py-16 px-4 md:px-6 lg:px-8 bg-gradient-to-b from-slate-50 to-white">
  <div class="max-w-7xl mx-auto">
    <!-- Section Header -->
    <!-- <div class="text-center mb-10">
        <h2 class="text-4xl md:text-5xl lg:text-6xl font-bold text-gray-900 mb-6">
            {excellency.title}
          </h2>          
          <div class="flex mt-6 justify-center">
            <div class="w-16 h-1 rounded-full bg-accent inline-flex"></div>
          </div>
          <p class="text-xl text-gray-600 max-w-3xl mx-auto leading-relaxed">
            {excellency.subtitle}            
      </p>
    </div> -->

    <div class="mx-auto mb-16 max-w-2xl text-center" data-aos="flip-down" data-aos-duration="1000">
      <h2 class="text-4xl font-bold tracking-tight text-gray-900 sm:text-5xl">{excellency.title}</h2>
      <div class="flex mt-6 justify-center">
        <div class="w-16 h-1 rounded-full bg-accent inline-flex"></div>
      </div>
      <p class="mt-4 text-lg text-gray-600">{excellency.subtitle}</p>
    </div>

    <!-- Carousel Container -->
    <div class="relative mb-8" data-aos="zoom-out-down" data-aos-duration="1000">
      <!-- Carousel Wrapper -->
      <div class="overflow-hidden rounded-2xl pb-6 w-full">
        <div id="carousel-track" class="flex transition-transform duration-500 ease-in-out items-stretch w-full">
          {services.map((service: any) => (
            <div class="w-full md:w-1/2 lg:w-1/3 flex-shrink-0 px-2 sm:px-3 flex">
              <div class="bg-white rounded-2xl shadow-lg hover:shadow-2xl transition-all duration-300 overflow-hidden border border-gray-100 h-full flex flex-col">

              <!-- Image Container -->
                <div class="relative overflow-hidden h-48 bg-gradient-to-br from-gray-900 to-primary">
                  <img
                    src={service.image || "/placeholder.svg"}
                    alt={service.title}
                    class="w-full h-full object-cover hover:scale-110 transition-transform duration-500"
                  />
                  <div class="absolute top-4 left-4">
                    <span class="px-3 py-1 bg-white/90 backdrop-blur-sm text-blue-600 text-xs font-semibold rounded-full">
                      {service.category}
                    </span>
                  </div>
                  <div class="absolute inset-0 bg-gradient-to-t from-black/20 to-transparent"></div>
                </div>

                <!-- Content -->
                <div class="p-3 flex flex-col flex-grow">
                  <h3 class="text-lg font-bold text-gray-900 mb-3 hover:text-blue-600 transition-colors">
                    {service.title}
                  </h3>
                  <p class="text-gray-600 mb-4 leading-relaxed flex-grow">
                    {service.description}
                  </p>

                  <!-- Features -->
                  {/* <div class="space-y-2 mb-6">
                    {service.features.map((feature) => (
                      <div class="flex items-center text-sm text-gray-700">
                        <svg class="w-4 h-4 text-green-500 mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                          <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                        </svg>
                        {feature}
                      </div>
                    ))}
                  </div> */}

                  <!-- CTA Button -->
                  <button class="mt-auto w-full bg-gradient-to-r from-gray-900 to-primary text-white font-semibold py-3 px-6 rounded-lg hover:from-primary hover:to-gray-900 transition-all duration-300 transform focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                    Leer Más
                  </button>
                </div>
              </div>
            </div>
          ))}
        </div>
      </div>

      <!-- Navigation Buttons -->
      <button
        id="prev-btn"
        class="hidden sm:flex absolute left-4 top-1/2 -translate-y-1/2 bg-white/90 backdrop-blur-sm text-gray-800 p-3 rounded-full shadow-lg hover:shadow-xl transition-all duration-300 z-10 opacity-50 disabled:cursor-not-allowed hover:scale-105 hover:bg-blue-600 hover:opacity-100"
        aria-label="Previous slide"
      >
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
        </svg>
      </button>

      <button
        id="next-btn"
        class="hidden sm:flex absolute right-4 top-1/2 -translate-y-1/2 bg-white/90 backdrop-blur-sm text-gray-800 p-3 rounded-full shadow-lg hover:shadow-xl transition-all duration-300 z-10 opacity-50 disabled:cursor-not-allowed hover:scale-105 hover:bg-blue-600 hover:opacity-100"
        aria-label="Next slide"
      >
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
        </svg>
      </button>

    </div>

    <!-- Carousel Indicators -->
    <div class="flex justify-center space-x-2 mb-8">
      {services.map((_: any, index:any) => (
        <button
          class="carousel-indicator w-3 h-3 rounded-full bg-gray-300 hover:bg-blue-500 transition-colors duration-300"
          data-slide={index}
          aria-label={`Go to slide ${index + 1}`}
        ></button>
      ))}
    </div>

    <!-- Bottom CTA Section -->
    <div class="text-center bg-gradient-to-r from-gray-900 to-primary rounded-2xl p-8 md:p-12 text-white">
      <h3 class="text-2xl md:text-3xl font-bold mb-4">
        {cta.title}
      </h3>
      <p class="text-blue-100 mb-6 max-w-2xl mx-auto">
        {cta.description}
      </p>
      <div class="flex flex-col sm:flex-row gap-4 justify-center">
        <button id="view-portfolio-btn" class="border-2 border-white text-white font-semibold py-3 px-8 rounded-lg hover:bg-white hover:text-blue-600 transition-colors duration-300">
          {cta.buttonText}
        </button>
      </div>
    </div>

    <!-- Technical Specs -->
    <!-- <div class="mt-16 grid grid-cols-2 md:grid-cols-4 gap-8 text-center">
      <div class="space-y-2">
        <div class="text-3xl font-bold text-blue-600">0.3m</div>
        <div class="text-gray-600 text-sm">Resolution</div>
      </div>
      <div class="space-y-2">
        <div class="text-3xl font-bold text-blue-600">24/7</div>
        <div class="text-gray-600 text-sm">Coverage</div>
      </div>
      <div class="space-y-2">
        <div class="text-3xl font-bold text-blue-600">12</div>
        <div class="text-gray-600 text-sm">Satellites</div>
      </div>
      <div class="space-y-2">
        <div class="text-3xl font-bold text-blue-600">48h</div>
        <div class="text-gray-600 text-sm">Delivery</div>
      </div>
    </div>
  </div> -->
</section>

<PortfolioModal t={t}/>

<script is:inline>
  document.addEventListener('DOMContentLoaded', function() {
    const track = document.getElementById('carousel-track');
    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');
    const indicators = document.querySelectorAll('.carousel-indicator');
    const viewPortfolioBtn = document.getElementById('view-portfolio-btn');

    let currentSlide = 0;
    const totalSlides = indicators.length;
    let slidesPerView = getSlidesPerView();
    let maxSlide = Math.max(0, totalSlides - slidesPerView);
    let autoPlayInterval;

    function getSlidesPerView() {
      if (window.innerWidth >= 1024) return 3; // lg
      if (window.innerWidth >= 768) return 2;  // md
      return 1; // mobile
    }

    function updateCarousel() {
      const slideWidth = 100 / slidesPerView;
      const translateX = -(currentSlide * slideWidth);
      track.style.transform = `translateX(${translateX}%)`;

      // Update button states
      prevBtn.disabled = currentSlide === 0;
      nextBtn.disabled = currentSlide >= maxSlide;

      // Update indicators
      indicators.forEach(function(indicator, index) {
        if (index === currentSlide) {
          indicator.classList.remove('bg-gray-300');
          indicator.classList.add('bg-blue-500');
        } else {
          indicator.classList.remove('bg-blue-500');
          indicator.classList.add('bg-gray-300');
        }
      });
    }

    function nextSlide() {
      if (currentSlide < maxSlide) {
        currentSlide++;
      } else {
        currentSlide = 0; // Loop back to start
      }
      updateCarousel();
    }

    function prevSlide() {
      if (currentSlide > 0) {
        currentSlide--;
      } else {
        currentSlide = maxSlide; // Loop to end
      }
      updateCarousel();
    }

    function goToSlide(index) {
      currentSlide = Math.min(index, maxSlide);
      updateCarousel();
    }

    function startAutoPlay() {
      stopAutoPlay();
      autoPlayInterval = setInterval(function() {
        nextSlide();
      }, 2000);
    }

    function stopAutoPlay() {
      if (autoPlayInterval) {
        clearInterval(autoPlayInterval);
      }
    }

    // Event listeners
    prevBtn.addEventListener('click', prevSlide);
    nextBtn.addEventListener('click', nextSlide);

    indicators.forEach(function(indicator, index) {
      indicator.addEventListener('click', function() {
        goToSlide(index);
      });
    });

    // Touch/swipe support
    let startX = 0;
    let currentX = 0;
    let isDragging = false;

    track.addEventListener('touchstart', function(e) {
      startX = e.touches[0].clientX;
      isDragging = true;
      stopAutoPlay();
    });

    track.addEventListener('touchmove', function(e) {
      if (!isDragging) return;
      currentX = e.touches[0].clientX;
    });

    track.addEventListener('touchend', function() {
      if (!isDragging) return;
      isDragging = false;

      const diff = startX - currentX;
      if (Math.abs(diff) > 50) {
        if (diff > 0) {
          nextSlide();
        } else {
          prevSlide();
        }
      }
      startAutoPlay();
    });

    // Responsive handling
    window.addEventListener('resize', function() {
      slidesPerView = getSlidesPerView();
      maxSlide = Math.max(0, totalSlides - slidesPerView);
      currentSlide = Math.min(currentSlide, maxSlide);
      updateCarousel();
    });

    // Pause auto-play on hover
    track.addEventListener('mouseenter', stopAutoPlay);
    track.addEventListener('mouseleave', startAutoPlay);

    // Initialize
    updateCarousel();
    startAutoPlay();

    // Modal functionality - call the modal component's open function
    viewPortfolioBtn.addEventListener('click', function() {
      if (window.portfolioModal) {
        window.portfolioModal.open();
      }
    });
  });
</script>