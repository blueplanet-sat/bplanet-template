---
const { t } = Astro.props;
const excellency = t.excellency || {};
const services = excellency.services || [];
const cta = excellency.cta || {};
import PortfolioModal from './Modal-Carousel.astro';

---
<style is:global>
  .custom-shape-divider-top-1751413772 {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    overflow: hidden;
    line-height: 0;
    z-index: 10;
  }
  .custom-shape-divider-top-1751413772 svg {
    position: relative;
    display: block;
    width: calc(157% + 1.3px);
    height: 180px;
  }
  .custom-shape-divider-top-1751413772 .shape-fill {
    fill: #0A2540;
  }
</style>

<section class="py-16 px-4 md:px-6 lg:px-8 bg-gradient-to-b from-slate-50 to-white">
  <div class="custom-shape-divider-top-1751413772">
      <svg data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 120" preserveAspectRatio="none">
          <path d="M321.39,56.44c58-10.79,114.16-30.13,172-41.86,82.39-16.72,168.19-17.73,250.45-.39C823.78,31,906.67,72,985.66,92.83c70.05,18.48,146.53,26.09,214.34,3V0H0V27.35A600.21,600.21,0,0,0,321.39,56.44Z" class="shape-fill"></path>
      </svg>
  </div>
  <div class="max-w-7xl mx-auto">
    <!-- Section Header -->
    <!-- <div class="text-center mb-10">
        <h2 class="text-4xl md:text-5xl lg:text-6xl font-bold text-gray-900 mb-6">
            {excellency.title}
          </h2>          
          <div class="flex mt-6 justify-center">
            <div class="w-16 h-1 rounded-full bg-accent inline-flex"></div>
          </div>
          <p class="text-xl text-gray-600 max-w-3xl mx-auto leading-relaxed">
            {excellency.subtitle}            
      </p>
    </div> -->

    <div class="mx-auto mb-16 max-w-2xl text-center" data-aos="flip-down" data-aos-duration="1000">
      <h2 class="text-4xl font-bold tracking-tight text-gray-900 sm:text-5xl">{excellency.title}</h2>
      <div class="flex mt-6 justify-center">
        <div class="w-16 h-1 rounded-full bg-accent inline-flex"></div>
      </div>
      <p class="mt-4 text-lg text-gray-600">{excellency.subtitle}</p>
    </div>

    <!-- Carousel Container -->
    <div class="relative mb-8" data-aos="zoom-out-down" data-aos-duration="1000">
      <!-- Carousel Wrapper -->
      <div class="overflow-hidden rounded-2xl pb-6 w-full">
        <div id="carousel-track" class="flex transition-transform duration-500 ease-in-out items-stretch w-full">
          {services.map((service: any) => (
            <div class="w-full md:w-1/2 lg:w-1/3 flex-shrink-0 px-2 sm:px-3 flex">
              <div class="bg-white rounded-2xl shadow-lg hover:shadow-2xl transition-all duration-300 overflow-hidden border border-gray-100 h-full flex flex-col">

              <!-- Image Container -->
                <div class="relative overflow-hidden h-48 bg-gradient-to-br from-gray-900 to-primary">
                  <img
                    src={service.image || "/placeholder.svg"}
                    alt={service.title}
                    class="w-full h-full object-cover hover:scale-110 transition-transform duration-500"
                  />
                  <div class="absolute top-4 left-4">
                    <span class="px-3 py-1 bg-white/90 backdrop-blur-sm text-blue-600 text-xs font-semibold rounded-full">
                      {service.category}
                    </span>
                  </div>
                  <div class="absolute inset-0 bg-gradient-to-t from-black/20 to-transparent"></div>
                </div>

                <!-- Content -->
                <div class="p-3 flex flex-col flex-grow">
                  <h3 class="text-lg font-bold text-gray-900 mb-3 hover:text-blue-600 transition-colors">
                    {service.title}
                  </h3>
                  <p class="text-gray-600 mb-4 leading-relaxed flex-grow">
                    {service.description}
                  </p>

                  <!-- Features -->
                  {/* <div class="space-y-2 mb-6">
                    {service.features.map((feature) => (
                      <div class="flex items-center text-sm text-gray-700">
                        <svg class="w-4 h-4 text-green-500 mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                          <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                        </svg>
                        {feature}
                      </div>
                    ))}
                  </div> */}

                  <!-- CTA Button -->
                  <button class="mt-auto w-full bg-gradient-to-r from-gray-900 to-primary text-white font-semibold py-3 px-6 rounded-lg hover:from-primary hover:to-gray-900 transition-all duration-300 transform focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                    Leer MÃ¡s
                  </button>
                </div>
              </div>
            </div>
          ))}
        </div>
      </div>

      <!-- Navigation Buttons -->
      <button
        id="prev-btn"
        class="hidden sm:flex absolute left-4 top-1/2 -translate-y-1/2 bg-white/90 backdrop-blur-sm text-gray-800 p-3 rounded-full shadow-lg hover:shadow-xl transition-all duration-300 z-10 opacity-50 disabled:cursor-not-allowed hover:scale-105 hover:bg-blue-600 hover:opacity-100"
        aria-label="Previous slide"
      >
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
        </svg>
      </button>

      <button
        id="next-btn"
        class="hidden sm:flex absolute right-4 top-1/2 -translate-y-1/2 bg-white/90 backdrop-blur-sm text-gray-800 p-3 rounded-full shadow-lg hover:shadow-xl transition-all duration-300 z-10 opacity-50 disabled:cursor-not-allowed hover:scale-105 hover:bg-blue-600 hover:opacity-100"
        aria-label="Next slide"
      >
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
        </svg>
      </button>

    </div>

    <!-- Carousel Indicators -->
    <div class="flex justify-center space-x-2 mb-8">
      {services.map((_: any, index:any) => (
        <button
          class="carousel-indicator w-3 h-3 rounded-full bg-gray-300 hover:bg-blue-500 transition-colors duration-300"
          data-slide={index}
          aria-label={`Go to slide ${index + 1}`}
        ></button>
      ))}
    </div>

    <!-- Bottom CTA Section -->
    <div class="text-center bg-gradient-to-r from-gray-900 to-primary rounded-2xl p-8 md:p-12 text-white">
      <h3 class="text-2xl md:text-3xl font-bold mb-4">
        {cta.title}
      </h3>
      <p class="text-blue-100 mb-6 max-w-2xl mx-auto">
        {cta.description}
      </p>
      <div class="flex flex-col sm:flex-row gap-4 justify-center">
        <button id="view-portfolio-btn" class="border-2 border-white text-white font-semibold py-3 px-8 rounded-lg hover:bg-white hover:text-blue-600 transition-colors duration-300">
          {cta.buttonText}
        </button>
      </div>
    </div>

    <!-- Technical Specs -->
    <!-- <div class="mt-16 grid grid-cols-2 md:grid-cols-4 gap-8 text-center">
      <div class="space-y-2">
        <div class="text-3xl font-bold text-blue-600">0.3m</div>
        <div class="text-gray-600 text-sm">Resolution</div>
      </div>
      <div class="space-y-2">
        <div class="text-3xl font-bold text-blue-600">24/7</div>
        <div class="text-gray-600 text-sm">Coverage</div>
      </div>
      <div class="space-y-2">
        <div class="text-3xl font-bold text-blue-600">12</div>
        <div class="text-gray-600 text-sm">Satellites</div>
      </div>
      <div class="space-y-2">
        <div class="text-3xl font-bold text-blue-600">48h</div>
        <div class="text-gray-600 text-sm">Delivery</div>
      </div>
    </div>
  </div> -->
</section>

<PortfolioModal t={t}/>

<script is:inline>
  document.addEventListener('DOMContentLoaded', function() {
    const track = document.getElementById('carousel-track');
    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');
    const indicators = document.querySelectorAll('.carousel-indicator');
    const viewPortfolioBtn = document.getElementById('view-portfolio-btn');

    let currentSlide = 0;
    const totalSlides = indicators.length;
    let slidesPerView = getSlidesPerView();
    let maxSlide = Math.max(0, totalSlides - slidesPerView);
    let autoPlayInterval;

    function getSlidesPerView() {
      if (window.innerWidth >= 1024) return 3; // lg
      if (window.innerWidth >= 768) return 2;  // md
      return 1; // mobile
    }

    function updateCarousel() {
      const slideWidth = 100 / slidesPerView;
      const translateX = -(currentSlide * slideWidth);
      track.style.transform = `translateX(${translateX}%)`;

      // Update button states
      prevBtn.disabled = currentSlide === 0;
      nextBtn.disabled = currentSlide >= maxSlide;

      // Update indicators
      indicators.forEach(function(indicator, index) {
        if (index === currentSlide) {
          indicator.classList.remove('bg-gray-300');
          indicator.classList.add('bg-blue-500');
        } else {
          indicator.classList.remove('bg-blue-500');
          indicator.classList.add('bg-gray-300');
        }
      });
    }

    function nextSlide() {
      if (currentSlide < maxSlide) {
        currentSlide++;
      } else {
        currentSlide = 0; // Loop back to start
      }
      updateCarousel();
    }

    function prevSlide() {
      if (currentSlide > 0) {
        currentSlide--;
      } else {
        currentSlide = maxSlide; // Loop to end
      }
      updateCarousel();
    }

    function goToSlide(index) {
      currentSlide = Math.min(index, maxSlide);
      updateCarousel();
    }

    function startAutoPlay() {
      stopAutoPlay();
      autoPlayInterval = setInterval(function() {
        nextSlide();
      }, 2000);
    }

    function stopAutoPlay() {
      if (autoPlayInterval) {
        clearInterval(autoPlayInterval);
      }
    }

    // Event listeners
    prevBtn.addEventListener('click', prevSlide);
    nextBtn.addEventListener('click', nextSlide);

    indicators.forEach(function(indicator, index) {
      indicator.addEventListener('click', function() {
        goToSlide(index);
      });
    });

    // Touch/swipe support
    let startX = 0;
    let currentX = 0;
    let isDragging = false;

    track.addEventListener('touchstart', function(e) {
      startX = e.touches[0].clientX;
      isDragging = true;
      stopAutoPlay();
    });

    track.addEventListener('touchmove', function(e) {
      if (!isDragging) return;
      currentX = e.touches[0].clientX;
    });

    track.addEventListener('touchend', function() {
      if (!isDragging) return;
      isDragging = false;

      const diff = startX - currentX;
      if (Math.abs(diff) > 50) {
        if (diff > 0) {
          nextSlide();
        } else {
          prevSlide();
        }
      }
      startAutoPlay();
    });

    // Responsive handling
    window.addEventListener('resize', function() {
      slidesPerView = getSlidesPerView();
      maxSlide = Math.max(0, totalSlides - slidesPerView);
      currentSlide = Math.min(currentSlide, maxSlide);
      updateCarousel();
    });

    // Pause auto-play on hover
    track.addEventListener('mouseenter', stopAutoPlay);
    track.addEventListener('mouseleave', startAutoPlay);

    // Initialize
    updateCarousel();
    startAutoPlay();

    // Modal functionality - call the modal component's open function
    viewPortfolioBtn.addEventListener('click', function() {
      if (window.portfolioModal) {
        window.portfolioModal.open();
      }
    });
  });
</script>